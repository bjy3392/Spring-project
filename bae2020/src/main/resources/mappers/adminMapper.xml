<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.bae2020.dao.AdminDao">

	<select id="findCategoryByCode" resultType="com.spring.bae2020.vo.CategoryVo">
		select * from category where category_code like concat(#{code}, '%');
	</select>

	<insert id="insertCategory">
		insert into category (category_code,category_name,first_code,user_id,create_dt) 
		select concat('PROD', '-',(select lpad(count(*)+1,3,'0') from category where category_code like 'PROD%' ))
			 , #{category_name}, #{first_code}, #{mid}, now();
	</insert>
	
	<update id="updateCategory">
		update category set category_name=#{category_name} , first_code=#{first_code} where category_code=#{category_code};
	</update>
	
	<delete id="deleteCategory">
		delete from category where category_code = #{category_code};
	</delete>
	
	<select id="findProductCodeByCode" resultType="String">
		select concat(first_code, '-',(select lpad(count(*)+1,3,'0') from product where category_code = #{category_code}))
		  from category
	 	 where category_code = #{category_code};
	</select>
	
	<insert id="insertProduct">
		insert into product value (#{vo.product_code},#{vo.product_name},#{vo.category_code},#{vo.price},#{vo.image},#{vo.user_id},default);
	</insert>
	
	<select id="findProductByCode" resultType="com.spring.bae2020.vo.ProductVo">
		select * from product where category_code=#{category_code};
	</select>
	
	<update id="updateProduct">
		update product set product_name=#{vo.product_name}, price=#{vo.price } where product_code=#{vo.product_code};
	</update>
	
	<delete id="deleteProduct">
		delete from product where product_code = #{product_code};
	</delete>
	
	
</mapper>